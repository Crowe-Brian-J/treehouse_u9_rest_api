# Project 9 Checklist

## Getting Started

* [X] Open the project in a text editor.
* [X] Install dependencies (`npm install`).
* [X] Run `npm run seed` to create and seed **fsjstd-restapi.db**.
* [X] Verify the database using DB Browser.
* [X] Start the app (`npm start`) and check `http://localhost:3000/` for the welcome message.
* [X] **macOS Monterey, Ventura, Sonoma, Sequoia, & Tahoe:** Change port to 3000 (These instructions haven't been updated since at least 2021)

---

## Database Configuration

* [X] Install Sequelize.
* [X] Install Sequelize CLI as a dev dependency.
* [X] Run `npx sequelize init`.
* [X] Update `config.json`: // Updated by me

  * [X] `storage: "fsjstd-restapi.db"`
  * [X] `dialect: "sqlite"`
* [X] Use Sequelize’s `authenticate()` to test the connection.

---

## Define Models

* [X] Create **User** model with attributes:

  * [X] `firstName: string`
  * [X] `lastName: string`
  * [X] `emailAddress: string`
  * [X] `password: string`
  * [X] Generate with:

    ```
    npx sequelize model:create --name User --attributes firstName:string,lastName:string,emailAddress:string,password:string
    ```

* [X] Create **Course** model with attributes:

  * [X] `title: string`
  * [X] `description: text`
  * [X] `estimatedTime: string`
  * [X] `materialsNeeded: string`
  * [X] Generate with:

    ```
    npx sequelize model:create --name Course --attributes title:string,description:text,estimatedTime:string,materialsNeeded:string
    ```

---

## Define Associations

* [X] In **User model**: `User.hasMany(Course)`
* [X] In **Course model**: `Course.belongsTo(User)`
* [X] Set `foreignKey: "userId"` linked to `User.id`.

---

## Testing Setup

* [X] Install Postman.
* [X] Import `RESTAPI.postman_collection.json`.
* [X] Don’t modify requests in the provided collection.

---

## Create User Routes

* [X] `/api/users` **GET** → return current authenticated user (200).
* [X] `/api/users` **POST** → create new user, set `Location: "/"`, return (201).

---

## Create Course Routes

* [X] `/api/courses` **GET** → return all courses w/ User object (200).
* [X] `/api/courses/:id` **GET** → return course w/ User object (200).
* [X] `/api/courses` **POST** → create course, set `Location`, return (201).
* [X] `/api/courses/:id` **PUT** → update course (204).
* [X] `/api/courses/:id` **DELETE** → delete course (204).

---

## Model Validation

* [X] **Users POST:** require `firstName`, `lastName`, `emailAddress`, `password`.
* [X] **Courses POST/PUT:** require `title`, `description`.
* [X] Respond with **400** if validation fails.

---

## Password Security

* [X] Hash passwords before saving (use `bcrypt`).

---

## Authentication Middleware

* [X] Create middleware to parse `Authorization` header.
* [X] If valid → attach user to request, continue.
* [X] If invalid → return **401** + `"Access Denied"`.
* [X] Apply middleware to:

  * [X] `/api/users GET`
  * [X] `/api/courses POST`
  * [X] `/api/courses/:id PUT`
  * [X] `/api/courses/:id DELETE`

---

## Final Checks

* [X] Add meaningful code comments.
* [X] Ensure consistent formatting & indentation.
* [ ] Test functionality thoroughly in browser & Postman.
* [ ] Watch console for errors, fix any bugs.
* [ ] Optional: share repo in Slack `#review-my-project` for feedback.

---

## Extra Credit (Exceeds Expectations)

* [X] **Email validation & uniqueness**:

  * [X] Validate email format.
  * [X] Add `unique: true` to `emailAddress`.
* [X] **User Routes updates**:

  * [X] Filter out `password`, `createdAt`, `updatedAt` in **GET /api/users**.
  * [X] Handle `SequelizeUniqueConstraintError` in **POST /api/users** (return 400).
* [X] **Course Routes updates**:

  * [X] Filter out `createdAt`, `updatedAt` in course GETs.
  * [X] Filter out `createdAt`, `updatedAt`, `password` in attached User object.
  * [X] Restrict **PUT/DELETE** to course owner; return **403** if not owner.

---

## Rubric
- Database Connection
  - [X] Sequelize is listed as a dependency in the package.json file
  - [X] Sequelize is configured to use the fsjstd-restapi.db SQLite database that's generated by the npm run seed command
  - [X] A message is written to the console when there's an error connecting to the db
  - [X] A message is written to the console when the database connection is successfully opened 
- User Model
  - [X] The user schema follows the provided specification:
    - [X] firstName (string)
    - [X] lastName (string)
    - [X] emailAddress (string)
    - [X] password (string)
- Course Model
  - [X] The course schema follows the provided specification
    - [X] title (string)
    - [X] description (text)
    - [X] estimatedTime (string)
    - [X] materialsNeeded (string)
- Model Associations
  - [X] A HasMany association is defined between the user and course models
  - [X] A BelongsTo association is defined between the course and user models
  - [X] foreignKey property is setup to hold the userId
- User Routes
  - [X] All of the following user routes are available and return the following data as specified
    - [X] GET /api/users 200 - Returns the currently authenticated user
      - [X] Ensure that id, firstName, lastName and email are still included in the response
    - [X] POST /api/users 201 - Creates a user, sets the Location header to '/' and returns no content
  - [X] EXCEEDS EXPECTATIONS
    - [X] The GET /api/users route filters out the following properties
      - [X] Password
      - [X] createdAt
      - [X] updatedAt
      - [X] Ensure that id, firstName, lastName, and email are still included in the response
    - [X] The POST /api/users route checks for and handles 'SequelizeUniqueConstraintError errors by returning a 400 status code and error message
- Course Routes
  - [X] All of the following course routes are available and return the following data as specified
    - [X] GET /api/courses 200 - Returns a list of courses (including the associated User object)
    - [X] GET /api/courses/:id 200 - Returns the course (including the associated User object with each course) for the provided course ID
    - [X] POST /api/courses 201 - Creates a course, sets the 'Location' header to the URI for the course, and returns no content
    - [X] PUT /api/courses/:id 204 - Updates a course and returns no content
    - [X] DELETE /api/courses/:id 204 - Deletes a course and returns no content
  - [X] EXCEEDS EXPECTATIONS
    - [X] The GET /api/courses and /api/courses/:id routes filter out the following properties:
      - [X] createdAt
      - [X] updatedAt
    - [X] The PUT /api/courses/:id and DELETE /api/courses/:id routes return a 403 status code if the current user doesn't own the requested course
- Validations
  - [X] The POST route for the User model validates if the request body contains the following values:
    - [X] firstName
    - [X] lastName
    - [X] emailAddress
    - [X] password
  - [X] The POST and PUT routes for the Course model validate if the request body contains the following required values:
    - [X] title
    - [X] description
  - [X] Validation error(s) are sent with a 400 status code
  - [X] EXCEEDS EXPECTATIONS
    - [X] The POST /api/users route validatees that the provided email address is a valid email address and isn't already associated with an existing user
- Password Security
  - [X] The POST /api/users route hashes the user's password before persisting the user to the database
- Permissions
  - [X] An express middleware function authenticates the following routes:
    - [X] GET /api/users
    - [X] POST /api/courses
    - [X] PUT /api/courses/:id
    - [X] DELETE /api/courses/:id
  - [X] When authentication fails, a 401 status code is returned